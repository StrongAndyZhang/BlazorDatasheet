@inherits BaseEditor
@using BlazorDatasheet.Core.Interfaces
@using BlazorDatasheet.Core.Data
@using BlazorDatasheet.Core.Edit

<HighlightedInput
    Style="@Style"
    CellHeight="_cellHeight"
    CellWidth="_cellWidth"
    CarePositionChanged="OnCaretPositionChanged"
    @bind-Value:set="OnInput"
    @bind-Value:get="CurrentValue"/>

@code {

    private double _cellWidth = 0;
    private double _cellHeight = 0;

    public override void BeforeEdit(IReadOnlyCell cell, Sheet sheet)
    {
        _cellWidth = sheet.Columns.GetVisualWidth(cell.Col);
        _cellHeight = sheet.Rows.GetVisualHeight(cell.Row);
        StateHasChanged();
    }

    private void OnInput(string value)
    {
        var newValue = value ?? string.Empty;
        CurrentValue = newValue;
    }

    public override void BeginEdit(EditEntryMode entryMode, string? editValue, string key)
    {
        if (entryMode == EditEntryMode.Key && !String.IsNullOrEmpty(key) && key.Length == 1)
        {
            CurrentValue = key;
        }
        else
        {
            CurrentValue = editValue?.ToString() ?? string.Empty;
        }
    }

    private void OnCaretPositionChanged(int position)
    {
    }

}